function conDate(a){var b=new Date(a),c=b.getUTCDate(),d=b.getUTCMonth()+1,e=b.getUTCFullYear(),f=d+"/"+c+"/"+e;return"1/1/1970"===f&&(f=null),f}function popup(a,b){b.bindPopup("<h4>Sanitary System Overflow</h4><h5>Date: <small>"+conDate(a.properties.SSO_DATE)+"</small><h5>Address: <small>"+a.properties.ADDRESS+"</small></h5><h5>Duration: <small>"+a.properties.DURATION+"</small></h5><h5>Fish Kill: <small>"+a.properties.FISH_KILL+"</small></h5><h5>Estimated Gallons: <small>"+a.properties.EST_GALLON+"</small></h5><h5>Primary Cause: <small>"+a.properties.PRIMARY_CAUSE+"</small></h5><h5>Secondary Cause: <small>"+a.properties.SECONDARY_CAUSE+"</small><h5>Rating: <small>"+a.properties.CAUSE_RATING+"</small><h5>Tributary: <small>"+a.properties.TRIBUTARY+"</small></h5><h5>Basin: <small>"+a.properties.BASIN+"</small>")}function markerToLayer(a,b){var c=L.icon({iconUrl:"/images/sso-icon.png",iconRetinaUrl:"/images/sso-icon.png",shadowUrl:"/images/marker-shadow.png"});return L.marker(b,{icon:c})}function findMidpoint(a,b){var c=(a[0]+b[0])/2,d=(a[1]+b[1])/2;$("#coords",init.formframe).text(c+", "+d)}function getSSOLatLng(a){a.geometry.coordinates[0].length>1?findMidpoint(a.geometry.coordinates[0],a.geometry.coordinates[1]):$("#coords",init.formframe).text(a.geometry.coordinates[0]+", "+a.geometry.coordinates[1])}function form(a,b){$("#ADDRESS",init.formframe).attr("value",getAddress()),$("#BASIN",init.formframe).attr("value",a.properties.BASIN),$("#PIPE_DIAM",init.formframe).attr("value",a.properties.DIAMETER),$("#PIPEMATERI",init.formframe).attr("value",a.properties.MATERIAL),$("#LASTCLEANDATE",init.formframe).attr("value",getCurrentDate()),$("#SSO_DATE",init.formframe).attr("value",getCurrentDate()),$("#FACILITYID",init.formframe).attr("value",a.properties.FACILITYID),$("#CITY",init.formframe).attr("value",a.properties.JURISDICTION),getSSOLatLng(a);var c=init.formframe.prop("innerHTML");init.innerpopup=c;var d=L.popup(popupOptions).setContent(init.innerpopup);init.post.geometry.x=$("#coords").text(),b.bindPopup(d)}function manholeMarker(a,b){var c=L.icon({iconUrl:"/images/manhole-icon-green.png",iconRetinaUrl:"/images/manhole-icon-green.png",iconAnchor:[12,17]});return L.marker(b,{icon:c})}function pipeStyles(a){var b={color:a,weight:5,opacity:.65,lineCap:"butt"};return b}function loading(a){a.on("loading",function(){map.spin(!0)}),a.on("load",function(){map.spin(!1)})}function zoomToFeature(a,b){map.fitBounds([[b,a]]);L.circle([b,a],40,{color:"red",fillColor:"#f03",fillOpacity:.5}).addTo(map)}function removeTable(){tableborder.remove(),map.dragging.enable()}function printPopup(){window.print()}function getCurrentDate(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return c+"/"+b+"/"+d}function getAddress(){var a=document.getElementById("leaflet-control-geosearch-qry");return null===a.value?"Add Address...":a.value}function mapTable(){function a(a){var b=L.control({position:"bottomright"});b.onAdd=function(){var a=L.DomUtil.create("div","info table");return a.innerHTML='<div id="tableborder" class="container"><div class="col-md-12"><button type="button" class="btn btn-danger btn-sm" style="margin-left: 50em; margin-bottom: -50px;" onclick="removeTable();">Close</button><table id="datatable" class="table table-hover"></table></div></div>',a},1!=$("#tableborder").length&&(b.addTo(map),$("#tableborder").draggable(),$("#tableborder").hover(function(){map.dragging.disable()},function(){map.dragging.enable()}),jQuery.fn.dataTableExt.oSort["string-case-asc"]=function(a,b){return b>a?-1:a>b?1:0},jQuery.fn.dataTableExt.oSort["string-case-desc"]=function(a,b){return b>a?1:a>b?-1:0},$(document).ready(function(){$("#datatable").dataTable({sPaginationType:"bootstrap",aaData:a,bProcessing:!0,bDeferRender:!0,bRetrieve:!0,iDisplayLength:5,aLengthMenu:[5,10,15,20],aaSorting:[[0,"asc"],[1,"asc"]],aoColumns:[{sTitle:"SSO Date"},{sTitle:"Address"},{sTitle:"Duration"},{sTitle:"Fish Kill"},{sTitle:"Est Gallon",sClass:"center"},{sTitle:"Primary Cause",sClass:"center"},{sTitle:"Secondary Cause",sClass:"center"},{sTitle:"Tributary",sClass:"center"},{sTitle:"Street Book",sClass:"center"},{sTitle:"Zoom To",sClass:"center"}]})}))}var b={lines:13,length:10,width:10,radius:20,corners:1,rotate:0,direction:1,color:"#6C8CD5",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"100%",left:"50%"},c=document.getElementById("spin"),d={items:[],start:0,spinner:new Spinner(b),url:function(b){var e="http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/MapServer/0/query?where=OBJECTID>"+b+"&outFields=*&f=pjson&geometry=true&inSR=4326&outSR=4326";$.getJSON(e,function(b){d.spinner.spin(c),console.log(b);for(var e in b.features){var f=b.features[e].attributes.SSO_DATE,g=b.features[e].attributes.ADDRESS,h=b.features[e].attributes.DURATION,i=b.features[e].attributes.FISH_KILL,j=b.features[e].attributes.EST_GALLON,k=b.features[e].attributes.PRIMARY_CAUSE,l=b.features[e].attributes.TRIBUTARY,m=b.features[e].attributes.STREETBOOK,n=b.features[e].attributes.GAL2CREEK,o=b.features[e].attributes.BASIN,p=b.features[e].attributes.CAUSE_RATING,q=b.features[e].attributes.SECONDARY_CAUSE,r=b.features[e].attributes.TIME_CALLED,s=b.features[e].attributes.TIME_ARRIVED,t=b.features[e].attributes.TIME_STOPPED,u=b.features[e].geometry.x,v=b.features[e].geometry.y,w=new Date(f),x=w.getUTCDate(),y=w.getUTCMonth()+1,z=w.getUTCFullYear(),A=y+"/"+x+"/"+z;"1/1/1970"==A&&(A=null),d.items.push([A,g,h,i,j,k,q,l,m,'<button id="zoomSSO" type="button" class="btn btn-primary btn-sm" onclick="zoomToFeature('+u+","+v+');">Zoom</button>',n,o,p,r,s,t])}1e3==b.features.length?(d.start=d.start+1e3,d.url(d.start)):(console.log("Data Finished Loading"),a(d.items),d.spinner.stop())})}};d.url(d.start)}!function(a){var b=function(){var b=a.documentMode;return"onhashchange"in a&&(void 0===b||b>7)}();L.Hash=function(a){this.onHashChange=L.Util.bind(this.onHashChange,this),a&&this.init(a)},L.Hash.parseHash=function(a){0===a.indexOf("#")&&(a=a.substr(1));var b=a.split("/");if(3==b.length){var c=parseInt(b[0],10),d=parseFloat(b[1]),e=parseFloat(b[2]);return isNaN(c)||isNaN(d)||isNaN(e)?!1:{center:new L.LatLng(d,e),zoom:c}}return!1},L.Hash.formatHash=function(a){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return"#"+[c,b.lat.toFixed(d),b.lng.toFixed(d)].join("/")},L.Hash.prototype={map:null,lastHash:null,parseHash:L.Hash.parseHash,formatHash:L.Hash.formatHash,init:function(a){this.map=a,this.lastHash=null,this.onHashChange(),this.isListening||this.startListening()},removeFrom:function(){this.changeTimeout&&clearTimeout(this.changeTimeout),this.isListening&&this.stopListening(),this.map=null},onMapMove:function(){if(this.movingMap||!this.map._loaded)return!1;var a=this.formatHash(this.map);this.lastHash!=a&&(location.replace(a),this.lastHash=a)},movingMap:!1,update:function(){var a=location.hash;if(a!==this.lastHash){var b=this.parseHash(a);b?(this.movingMap=!0,this.map.setView(b.center,b.zoom),this.movingMap=!1):this.onMapMove(this.map)}},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var a=this;this.changeTimeout=setTimeout(function(){a.update(),a.changeTimeout=null},this.changeDefer)}},isListening:!1,hashChangeInterval:null,startListening:function(){this.map.on("moveend",this.onMapMove,this),b?L.DomEvent.addListener(a,"hashchange",this.onHashChange):(clearInterval(this.hashChangeInterval),this.hashChangeInterval=setInterval(this.onHashChange,50)),this.isListening=!0},stopListening:function(){this.map.off("moveend",this.onMapMove,this),b?L.DomEvent.removeListener(a,"hashchange",this.onHashChange):clearInterval(this.hashChangeInterval),this.isListening=!1}},L.hash=function(a){return new L.Hash(a)},L.Map.prototype.addHash=function(){this._hash=L.hash(this)},L.Map.prototype.removeHash=function(){this._hash.removeFrom()}}(window),L.SpinMapMixin={spin:function(a,b){a?(this._spinner||(this._spinner=new Spinner(b).spin(this._container),this._spinning=0),this._spinning++):(this._spinning--,this._spinning<=0&&this._spinner&&(this._spinner.stop(),this._spinner=null))}},L.Map.include(L.SpinMapMixin),L.Map.addInitHook(function(){this.on("layeradd",function(a){a.layer.loading&&this.spin(!0),"function"==typeof a.layer.on&&(a.layer.on("data:loading",function(){this.spin(!0)},this),a.layer.on("data:loaded",function(){this.spin(!1)},this))},this),this.on("layerremove",function(a){a.layer.loading&&this.spin(!1),"function"==typeof a.layer.on&&(a.layer.off("data:loaded"),a.layer.off("data:loading"))},this)}),!function(){"use strict";function a(b){return this instanceof a?(this._canvas=b="string"==typeof b?document.getElementById(b):b,this._ctx=b.getContext("2d"),this._width=b.width,this._height=b.height,this._max=1,void this.clear()):new a(b)}a.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(a){return this._data=a,this},max:function(a){return this._max=a,this},add:function(a){return this._data.push(a),this},clear:function(){return this._data=[],this},radius:function(a,b){b=b||15;var c=this._circle=document.createElement("canvas"),d=c.getContext("2d"),e=this._r=a+b;return c.width=c.height=2*e,d.shadowOffsetX=d.shadowOffsetY=200,d.shadowBlur=b,d.shadowColor="black",d.beginPath(),d.arc(e-200,e-200,a,0,2*Math.PI,!0),d.closePath(),d.fill(),this},gradient:function(a){var b=document.createElement("canvas"),c=b.getContext("2d"),d=c.createLinearGradient(0,0,0,256);b.width=1,b.height=256;for(var e in a)d.addColorStop(e,a[e]);return c.fillStyle=d,c.fillRect(0,0,1,256),this._grad=c.getImageData(0,0,1,256).data,this},draw:function(a){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var b=this._ctx;b.clearRect(0,0,this._width,this._height);for(var c,d=0,e=this._data.length;e>d;d++)c=this._data[d],b.globalAlpha=Math.max(c[2]/this._max,a||.05),b.drawImage(this._circle,c[0]-this._r,c[1]-this._r);var f=b.getImageData(0,0,this._width,this._height);return this._colorize(f.data,this._grad),b.putImageData(f,0,0),this},_colorize:function(a,b){for(var c,d=3,e=a.length;e>d;d+=4)c=4*a[d],c&&(a[d-3]=b[c],a[d-2]=b[c+1],a[d-1]=b[c+2])}},window.simpleheat=a}(),L.HeatLayer=L.Class.extend({initialize:function(a,b){this._latlngs=a,L.setOptions(this,b)},setLatLngs:function(a){return this._latlngs=a,this.redraw()},addLatLng:function(a){return this._latlngs.push(a),this.redraw()},setOptions:function(a){return L.setOptions(this,a),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(a){this._map=a,this._canvas||this._initCanvas(),a._panes.overlayPane.appendChild(this._canvas),a.on("moveend",this._reset,this),a.options.zoomAnimation&&L.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._canvas),a.off("moveend",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},_initCanvas:function(){var a=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),b=this._map.getSize();a.width=b.x,a.height=b.y;var c=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(a,"leaflet-zoom-"+(c?"animated":"hide")),this._heat=simpleheat(a),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var a=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,a);var b=this._map.getSize();this._heat._width!==b.x&&(this._canvas.width=this._heat._width=b.x),this._heat._height!==b.y&&(this._canvas.height=this._heat._height=b.y),this._redraw()},_redraw:function(){var a,b,c,d,e,f,g,h,i,j=[],k=this._heat._r,l=this._map.getSize(),m=new L.LatLngBounds(this._map.containerPointToLatLng(L.point([-k,-k])),this._map.containerPointToLatLng(l.add([k,k]))),n=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,o=1/Math.pow(2,Math.max(0,Math.min(n-this._map.getZoom(),12))),p=k/2,q=[],r=this._map._getMapPanePos(),s=r.x%p,t=r.y%p;for(a=0,b=this._latlngs.length;b>a;a++)m.contains(this._latlngs[a])&&(c=this._map.latLngToContainerPoint(this._latlngs[a]),e=Math.floor((c.x-s)/p)+2,f=Math.floor((c.y-t)/p)+2,i=(this._latlngs[a].alt||1)*o,q[f]=q[f]||[],d=q[f][e],d?(d[0]=(d[0]*d[2]+c.x*i)/(d[2]+i),d[1]=(d[1]*d[2]+c.y*i)/(d[2]+i),d[2]+=i):q[f][e]=[c.x,c.y,i]);for(a=0,b=q.length;b>a;a++)if(q[a])for(g=0,h=q[a].length;h>g;g++)d=q[a][g],d&&j.push([Math.round(d[0]),Math.round(d[1]),Math.min(d[2],1)]);this._heat.data(j).draw(),this._frame=null},_animateZoom:function(a){var b=this._map.getZoomScale(a.zoom),c=this._map._getCenterOffset(a.center)._multiplyBy(-b).subtract(this._map._getMapPanePos());this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(c)+" scale("+b+")"}}),L.heatLayer=function(a,b){return new L.HeatLayer(a,b)};var map=L.map("map").setView([35.843768,-78.6450559],11),hash=new L.Hash(map),Orthos2013=L.esri.basemapLayer("Imagery"),myIcon=L.icon({iconUrl:"/images/marker-icon-red.png",iconRetinaUrl:"/images/marker-icon-red.png",shadowUrl:"/images/marker-shadow.png"}),GeoCoder=new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.Google,position:"topcenter",showMarker:!0}).addTo(map),popupOptions={minWidth:800,maxWidth:3e3,maxHeight:500,keepInView:!0};map.on("dblclick",function(a){var b=L.circleMarker(a.latlng,{fillColor:"#FF0000",radius:4,color:"#63B355",weight:1,fillOpacity:1}).addTo(map),c=a.latlng.lng,d=a.latlng.lat;$("#coords",init.formframe).text(c+", "+d);var e=init.formframe.prop("innerHTML");init.innerpopup=e;var f=L.popup(popupOptions).setContent(init.innerpopup);b.bindPopup(f),b.openPopup()});var sso=L.esri.featureLayer("http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/MapServer/0",{onEachFeature:popup,pointToLayer:markerToLayer});loading(sso);var heat=new L.esri.HeatMapFeatureLayer("http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/MapServer/0",{radius:60,blur:30});loading(heat);var gravitymains=L.esri.featureLayer("http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/SewerCollection/MapServer/11",{onEachFeature:form,style:pipeStyles("#8EF13C")});loading(gravitymains);var forcemains=L.esri.featureLayer("http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/SewerCollection/MapServer/12",{onEachFeature:form,style:pipeStyles("#A60000")});loading(forcemains);var laterals=L.esri.featureLayer("http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/SewerCollection/MapServer/14",{onEachFeature:form,style:pipeStyles("#078600")});loading(laterals);var manholes=L.esri.clusteredFeatureLayer("http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/SewerCollection/MapServer/5",{onEachMarker:form,createMarker:manholeMarker});loading(manholes);var baseLayers={Terrain:L.mapbox.tileLayer("rpud.i607pg2j").addTo(map),Orthos2013:Orthos2013},overlays={SSOs:sso,Manholes:manholes,"Gravity Mains":gravitymains,"Force Mains":forcemains,Laterals:laterals,"SSO Heat Map":heat};L.control.layers(baseLayers,overlays).addTo(map);var ssoTable=L.control({position:"bottomleft"});ssoTable.onAdd=function(){var a=L.DomUtil.create("div","info legend");return a.innerHTML='<button type="button" class="btn btn-primary" onclick="mapTable();">SSO Table</button>',a},ssoTable.addTo(map);var printer=L.control({position:"bottomright"});printer.onAdd=function(){var a=L.DomUtil.create("div","info legend");return a.innerHTML='<button type="button" class="btn btn-primary" onclick="window.print();">Print</button>',a},printer.addTo(map);var init={items:[],start:0,count:0,deleteID:0,innerpopup:"",fieldsurl:"http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/FeatureServer/0?f=pjson",updateurl:"http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/FeatureServer/0/addFeatures",deleteurl:"http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/DataCollection/FeatureServer/0/deleteFeatures",projecturl:"http://gis.raleighnc.gov/arcgis/rest/services/Utilities/Geometry/GeometryServer/project",post:{geometry:{},attributes:{}},fieldlengths:{},indata:[],formframe:$('<div id="popup"><div id="frame" class="btn-group"></div><div class="container-fluid"><h3 id="Ftext" class="text-primary">Add New Record</h3><br><div class="row"><div class="col-md-4"><form id="updater" class="cmxform" role="form" method="post"></div><div class="col-md-4"><div id="updater1"></div></div><div class="col-md-4"><div id="updater2"></div></div></form></div></div></div>'),DataObj:function(){for(var a in init.post.attributes)init.post.attributes[a]=$(init.post.attributes[a]).val();var b=$("#coords").text(),c=b.split(",");init.post.geometry.x=c[0],init.post.geometry.y=c[1]},reproject:function(a,b){$.ajax({url:init.projecturl,type:"POST",dataType:"json",data:{f:"json",inSR:4326,outSR:2264,geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:[{x:a,y:b}]})},success:function(a){console.log(a),init.post.geometry.x=a.geometries[0].x,init.post.geometry.y=a.geometries[0].y}})},url:function(){var a=init.fieldsurl;$.getJSON(a,function(a){console.log(a);var b={FACILITYID:'<div id="FACILITYIDdiv" class="form-group"><label for="FACILITYID">FACILITYID</label><input id="FACILITYID" type="text" maxlength="50" class="form-control" placeholder=""></div>',SSO_DATE:'<div id="SSO_DATEdiv" class="form-group"><label for="SSO_DATE">SSO DATE<i class="text-danger"> (Required)</i></label><input type="date" class="form-control" id="SSO_DATE" value="'+getCurrentDate()+'"></div>',ADDRESS:'<div id="ADDRESSdiv" class="form-group"><label for="ADDRESS">ADDRESS</label><input id="ADDRESS" type="text" maxlength="50" class="form-control" placeholder="'+getAddress()+'"></div>',PRIMARY_CAUSE:'<div id="PRIMARY_CAUSEdiv" class="form-group"><label for="PRIMARY_CAUSE">PRIMARY CAUSE</label><br><select id="PRIMARY_CAUSE" ></select></div>',SECONDARY_CAUSE:'<div id="SECONDARY_CAUSEdiv" class="form-group"><label for="SECONDARY_CAUSE">SECONDARY CAUSE</label><br><select id="SECONDARY_CAUSE" ></select></div>',CAUSE_RATING:'<div id="CAUSE_RATINGdiv" class="form-group"><label for="CAUSE_RATING">CAUSE RATING</label><br><select id="CAUSE_RATING" ><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>',NOTES:'<div id="NOTESdiv" class="form-group"><label for="NOTES">NOTES</label><textarea class="form-control" rows="3"></textarea></div>',DURATION:'<div id="DURATIONdiv" class="form-group"><label for="DURATION">DURATION</label><input id="DURATION" type="text" maxlength="24" class="form-control" placeholder=""></div>',CITY:'<div id="CITYdiv" class="form-group"><label for="CITY">CITY</label><input id="CITY" type="text" maxlength="25" class="form-control" placeholder=""></div>',TRIBUTARY:'<div id="TRIBUTARYdiv" class="form-group"><label for="TRIBUTARY">TRIBUTARY</label><input id="TRIBUTARY" type="text" maxlength="41" class="form-control" placeholder=""></div>',BASIN:'<div id="BASINdiv" class="form-group"><label for="BASIN">BASIN</label><input id="BASIN" type="text" maxlength="25" class="form-control" placeholder=""></div>',EST_GALLON:'<div id="EST_GALLONdiv" class="form-group"><label for="EST_GALLON">ESTIMATED GALLONS</label><input type="number" id="EST_GALLON" class="form-control" value="0"></div>',GAL2CREEK:'<div id="GAL2CREEKdiv" class="form-group"><label for="GAL2CREEK">GALLONS TO CREEK</label><input type="number" id="GAL2CREEK" class="form-control" value="0"></div>',FISH_KILL:'<div id="FISH_KILLdiv" class="form-group"><label for="FISH_KILL">FISH KILL</label><br><select id="FISH_KILL" ><option value="NO">NO</option><option value="YES">YES</option></select></div>',PIPEMATERI:'<div id="PIPEMATERIdiv" class="form-group"><label for="PIPEMATERI ">PIPE MATERIAL</label><input id="PIPEMATERI" type="text" maxlength="30" class="form-control" placeholder=""></div>',PIPE_DIAM:'<div id="PIPE_DIAMdiv" class="form-group"><label for="PIPE_DIAM">PIPE DIAMETER</label><input id="PIPE_DIAM" type="number" class="form-control" placeholder=""></div>',STREETBOOK:'<div id="STREETBOOKdiv" class="form-group"><label for="STREETBOOK">STREETBOOK</label><input id="STREETBOOK" type="text" maxlength="10" class="form-control" placeholder=""></div>',LASTCLEANDATE:'<div id="LASTCLEANDATEdiv" class="form-group"><label for="LASTCLEANDATE">LAST CLEAN DATE<i class="text-danger"> (Required)</i></label><input type="date" class="form-control" id="LASTCLEANDATE" value="'+getCurrentDate()+'"></div>',TIME_CALLED:'<div id="TIME_CALLEDdiv" class="form-group"><label for="TIME_CALLED">TIME CALLED<i class="text-danger"> (Required)</i></label><input type="time" class="form-control" id="TIME_CALLED" value="" placeholder="12:00 AM"></div>',TIME_ARRIVED:'<div id="TIME_ARRIVEDdiv" class="form-group"><label for="TIME_ARRIVED">TIME ARRIVED<i class="text-danger"> (Required)</i></label><input type="time" class="form-control" id="TIME_ARRIVED" value="" placeholder="12:00 AM"></div>',TIME_STOPPED:'<div id="TIME_STOPPEDdiv" class="form-group"><label for="TIME_STOPPED">TIME STOPPED<i class="text-danger"> (Required)</i></label><input type="time" class="form-control" id="TIME_STOPPED" value="" placeholder="12:00 AM"></div>'};for(var c in b)init.start<7?$("#updater",init.formframe).append(b[c]):init.start>6&&init.start<14?$("#updater1",init.formframe).append(b[c]):$("#updater2",init.formframe).append(b[c]),init.start+=1,init.count+=1;for(var c in a.fields){{var d=a.fields[c].name,e=(a.fields[c].type,a.fields[c].length);a.fields[c].alias}if(("OBJECTID"!==d||"ID"!==d||"X_EASTING"!==d||"Y_NORTHING"!==d||"CAUSE_CATEG"!==d)&&(init.post.attributes[d]="#"+d,init.fieldlengths[d]=e),"PRIMARY_CAUSE"===d||"SECONDARY_CAUSE"===d)for(var f in a.fields[c].domain.codedValues){var g=a.fields[c].domain.codedValues[f].code;$("#"+d,init.formframe).append('<option value="'+g+'">'+g+"</option>")}}$("#updater2",init.formframe).append('<button id="update" type="submit" class="btn btn-primary btn-lg" onclick="init.submitForm();">Submit</button>'),$("#updater",init.formframe).append('<p id="coords"></p>');var h=init.formframe.prop("innerHTML");init.innerpopup=h})},submitForm:function(){init.indata=[],init.DataObj(),init.indata.push(init.post),init.indata[0].attributes.CAUSE_RATING=parseInt(init.indata[0].attributes.CAUSE_RATING),init.indata[0].attributes.EST_GALLON=parseInt(init.indata[0].attributes.EST_GALLON),init.indata[0].attributes.PIPE_DIAM=parseInt(init.indata[0].attributes.PIPE_DIAM),init.indata[0].attributes.GAL2CREEK=parseInt(init.indata[0].attributes.GAL2CREEK),init.indata[0].attributes.CAUSE_RATING=parseInt(init.indata[0].attributes.CAUSE_RATING),init.reproject(init.post.geometry.x,init.post.geometry.y),setTimeout(function(){$(function(){$.ajax({url:init.updateurl,type:"POST",dataType:"json",data:{f:"json",features:JSON.stringify(init.indata),gdbVersion:"SDE.DEFAULT"},success:function(a){console.log(a),a.error?(bootbox.alert('<h1 class="text-danger">FAILURE</h1><h3>The Record <strong class="text-danger">WAS NOT ADDED!!!</strong></h3><h4 class="text-warning">Code: '+a.error.code+", "+a.error.details[0]+'</h4><p>Please check to make sure all fields are filled out correctly</p><p class="text-muted">If the problem persists please call 919-996-2369</p><a id="try" class="btn btn-warning btn-lg" onclick="location.reload(true);">Try Again</a>'),$("#updater").remove(),$("#updater1").remove(),$("#updater2").remove(),$("#Ftext").remove(),$("#frame").append('<a id="try" class="btn btn-warning btn-lg" onclick="location.reload(true);">Try Again</a>')):1==a.addResults[0].success&&(init.deleteID=a.addResults[0].objectId,bootbox.alert("Object "+init.deleteID+' was Created<br><strong class="text-success">ADD COMPLETED</strong><p class="text-muted">Click Add New Record <strong class="text-warning">BEFORE</strong> entering new data</p>'),$("#updater").remove(),$("#updater1").remove(),$("#updater2").remove(),$("#Ftext").remove(),popupOptions.minWidth=200,$("#frame").append('<a id="new" class="btn btn-success btn-lg" href="../ssoform/index.html">Add New Record</a>'),$("#frame").append('<button id="delete" type="button" class="btn btn-danger btn-lg">Delete Last Record</button>'),$("#delete").click(function(){$.ajax({url:init.deleteurl,type:"POST",dataType:"json",data:{f:"json",objectIds:init.deleteID},success:function(a){console.log(a),$("#delete").remove(),bootbox.alert("Object "+init.deleteID+' Removed...<br><strong class="text-success">DELETE SUCCESSFUL</strong>')},error:function(a){console.log(a),bootbox.alert('<h1 class="text-danger">FAILURE</h1><h3>The Record WAS <strong class="text-danger">NOT Deleted!!!</strong></h3><p>If you still wish to delete the added feature please make changes via Microsoft Access</p><p class="text-muted">Future updates will allow you to make further changes in the browser...Sorry for the inconvience</p>')}}),setTimeout(function(){location.reload(!0)},3e3)}))}})})},1500)}};init.url();